#!/usr/bin/env python

import matplotlib.pyplot as plt
from matplotlib.colors import LinearSegmentedColormap 
from matplotlib.colors import LogNorm
import matplotlib.ticker as ticker
import numpy as np

plt.rcParams.update({'font.size': 12})


def create_heat_map(a, custom_cmap, filename):
    nm = np.matrix(a)

    fig, ax1 = plt.subplots()
    # ibm: 
    # im = plt.imshow(nm, cmap=custom_cmap, vmin=87, vmax=1350, interpolation='nearest')
    im = plt.imshow(nm, cmap=custom_cmap, interpolation='nearest', norm=LogNorm(vmin=24, vmax=1000))
    #im = plt.imshow(nm, cmap=custom_cmap, vmin=81, vmax=4024, interpolation='nearest')
    cb = plt.colorbar(im)

    ax1.xaxis.tick_top()
    #cb.set_label('Bandwidth (GB/s)', rotation=360, labelpad=20)
    cb.set_label('Bandwidth (GB/s)', rotation=360, labelpad=30)
    #cb.set_label('Latency (Î¼s)', rotation=360, labelpad=20, position=[0, 0.55])
    ax1.set_xlabel('Device id')    
    ax1.xaxis.set_label_position('top') 
    ax1.xaxis.set_label_coords(-0.12, 1.02)
    #show every gpu nr
    ax1.xaxis.set_major_locator(ticker.MultipleLocator(1))
    ax1.yaxis.set_major_locator(ticker.MultipleLocator(1))

    plt.savefig(filename, bbox_inches = 'tight', pad_inches = 0)

    plt.show()


#a = ('3.22   9.77   9.64   9.61   9.43   9.42   9.49   9.45   9.65   9.68   9.67   9.48   9.70   9.45   9.81   9.81;9.71   3.22   9.68   9.54   9.39   9.38   9.44   9.43   9.54   9.55   9.57   9.43   9.66   9.46   9.74   9.71; 9.67   9.45   3.30   9.43   9.39   9.39   9.43   9.40   9.53   9.55   9.47   9.41   9.48   9.38   9.57   9.58;     9.71   9.74   9.61   3.23   9.47   9.38   9.43   9.38   9.58   9.58   9.46   9.41   9.54   9.40   9.56   9.55;     9.75   9.78   9.73   9.55   3.22   9.39   9.44   9.42   9.49   9.49   9.69   9.43   9.51   9.39   9.82   9.74; 9.77   9.78   9.73   9.54   9.38   3.22   9.43   9.41   9.43   9.45   9.77   9.48   9.66   9.45   9.69   9.79;     9.77   9.77   9.65   9.57   9.40   9.41   3.22   9.44   9.52   9.51   9.62   9.45   9.48   9.43   9.73   9.71;    9.76   9.78   9.75   9.56   9.39   9.40   9.47   3.22   9.47   9.52   9.73   9.44   9.51   9.40   9.84   9.73;     10.32  10.13   9.91   9.99   9.91   9.92  10.08   9.96   3.51   9.85   9.88  10.02   9.90  10.00   9.84   9.85;     10.27  10.17   9.89   9.99   9.86   9.87  10.02   9.90   9.78   3.51   9.79   9.97   9.84   9.98   9.78   9.81;    10.23  10.08   9.84   9.98   9.87   9.90  10.00   9.92   9.76   9.78   3.52   9.96   9.84   9.92   9.77   9.81;    9.85   9.90   9.85   9.91   9.83   9.85  10.03   9.90   9.74   9.77   9.80   3.56   9.85   9.90   9.77   9.80;    9.91  10.01   9.84   9.89   9.86   9.89  10.03   9.90   9.75   9.82   9.77  10.03   3.56   9.93   9.77   9.78;    9.92  10.01   9.82   9.92   9.90   9.92  10.01   9.93   9.82   9.93   9.82  10.02   9.82   3.54   9.83   9.79;    9.90   9.96   9.84   9.84   9.85   9.88   9.96   9.87   9.77   9.82   9.83   9.99   9.83   9.93   3.52   9.79;    9.90   9.99   9.82   9.85   9.85   9.89  10.00   9.90   9.72   9.80   9.77   9.97   9.78   9.90   9.79   3.58')
# Yme latency:
a4 = ('89.10 743.06 1092.52 1119.50; 735.72  89.03 1086.50 1113.06; 1118.30 1118.86  89.08 1334.33; 1119.99 1119.22 1349.60  89.04')
a5 = ('89.20 470.10 817.41 821.70; 470.21  89.05 825.97 817.01; 820.17 822.77  89.13 471.11; 824.66 822.47 471.07  89.10')
yme_bw_uni_pci = ('744.36  44.93  30.50  29.89; 44.69 741.36  30.71  30.02;  29.91  30.05 741.36  25.32; 29.98  29.98  24.99 743.04')
yme_bw_uni_nvlink = ('741.04  71.35  41.08  40.78;  71.31 741.36  40.61  41.01;  40.92  40.76 742.88  71.22;  40.67  40.69  71.14 740.99')
yme_bw_bi_pci = ('779.03  57.94  44.84  45.46;  58.83 781.15  44.37  44.19;  44.31  44.89 782.11  23.38;  45.04  44.35  23.01 782.20 ')
yme_bw_bi_nvlink = ('776.52 142.03  39.78  39.14; 142.16 782.05  39.09  38.19; 39.68  39.06 782.99 141.67; 39.17  38.14 142.47 781.12')

# MS
a = ('87.80 1100.70; 1082.52  87.72')
a2 = ('87.77 814.64; 815.02  87.77')
ms_bw_uni_pci = ('753.29  30.36; 31.07 755.40') 
ms_bw_uni_nvlink = ('754.86  41.07; 41.08 753.29 ')
ms_bw_bi_pci = ('784.86  45.91; 46.45 789.89 ')
ms_bw_bi_nvlink = ('785.45  39.66; 39.64 790.54 ')

# DXG:
a3 = ('81.33 3930.25 3476.11 3478.56 3052.04 3053.20 3055.98 3056.75 3132.36 3133.17 3132.56 3133.77 3131.74 3132.39 3132.47 3131.79; 3948.65  81.34 3485.45 3484.45 3067.27 3065.14 3069.05 3069.41 3136.22 3135.56 3138.60 3137.08 3136.84 3135.42 3136.95 3134.57; 3484.32 3486.02  81.41 3488.37 3056.51 3057.64 3060.09 3062.63 3137.98 3137.29 3135.43 3132.78 3135.41 3131.40 3133.42 3131.45; 3477.46 3482.69 3486.46  81.35 3054.28 3055.11 3059.20 3057.97 3134.81 3135.10 3133.26 3134.98 3137.82 3134.47 3136.42 3132.55; 3057.82 3063.39 3057.19 3057.15  81.35 3940.70 3488.05 3487.39 3136.56 3136.41 3136.05 3136.16 3136.27 3133.75 3135.20 3132.95; 3058.32 3065.21 3055.74 3055.70 3945.80  81.31 3476.57 3472.66 3137.56 3134.83 3134.37 3135.91 3135.44 3135.12 3136.16 3135.37; 3060.39 3066.12 3061.97 3063.60 3484.47 3481.82  81.39 3479.11 3138.39 3141.16 3135.85 3141.35 3135.29 3138.48 3141.50 3137.30; 3060.04 3060.16 3062.15 3060.98 3492.21 3489.03 3493.40  81.35 3146.95 3137.23 3144.30 3134.52 3145.07 3135.79 3137.91 3134.21; 3080.22 3078.35 3079.17 3079.91 3081.09 3079.94 3083.25 3081.61  81.35 4024.21 3661.89 3659.70 3199.22 3199.73 3198.16 3199.14; 3079.07 3077.76 3080.76 3081.41 3081.32 3080.96 3082.05 3084.00 4023.44  81.33 3662.16 3657.66 3195.52 3196.07 3194.56 3195.22; 3081.33 3078.81 3080.57 3081.15 3082.62 3081.34 3078.68 3082.31 3665.89 3662.30  81.36 3625.09 3187.69 3187.42 3186.09 3188.23; 3078.64 3076.83 3081.35 3080.34 3079.28 3078.98 3077.98 3079.54 3663.82 3659.86 3629.93  81.31 3189.53 3188.68 3189.83 3190.66; 3080.57 3078.62 3082.21 3082.69 3081.60 3081.74 3081.35 3082.20 3193.07 3193.87 3193.13 3192.79  81.41 4021.30 3665.71 3657.15; 3080.24 3077.16 3077.94 3077.65 3079.76 3078.27 3077.08 3078.01 3197.12 3194.24 3194.41 3194.43 4021.11  81.36 3661.40 3655.29; 3078.14 3078.66 3078.20 3081.44 3079.49 3080.17 3076.41 3077.66 3188.24 3187.79 3188.30 3191.59 3661.03 3665.45  81.43 3626.81; 3074.77 3073.94 3077.46 3075.29 3078.99 3078.11 3076.67 3077.99 3188.07 3187.85 3186.12 3186.24 3660.21 3663.90 3627.05  81.38')
a6 = ('81.34 246.53 246.64 246.54 246.48 246.44 246.67 246.23 246.27 246.70 246.75 246.26 246.24 246.38 246.27 246.40; 246.41  81.33 246.53 246.50 246.49 246.40 246.54 246.34 246.26 246.70 246.74 246.30 246.45 246.37 246.27 246.50; 246.48 246.47  81.44 246.52 246.46 246.26 246.61 246.34 246.22 246.68 246.59 246.38 246.38 246.35 246.16 246.40; 246.37 246.48 246.49  81.34 246.45 246.32 246.46 246.24 246.25 246.71 246.57 246.16 246.28 246.43 246.26 246.42; 246.42 246.45 246.46 246.43  81.35 246.36 246.34 246.14 246.24 246.66 246.61 246.29 246.37 246.46 246.28 246.42; 246.50 246.49 246.39 246.44 246.33  81.34 246.51 246.22 246.24 246.60 246.58 246.23 246.48 246.55 246.37 246.46; 246.39 246.48 246.42 246.50 246.30 246.43  81.42 246.08 246.22 246.60 246.55 246.33 246.40 246.45 246.36 246.45; 246.35 246.66 246.46 246.41 246.35 246.48 246.56  81.31 246.32 246.62 246.66 246.16 246.37 246.50 246.20 246.46; 247.26 247.33 247.25 247.27 247.12 246.79 246.95 246.79  81.48 246.97 246.88 246.48 246.57 246.54 246.37 246.61; 247.13 247.34 247.20 247.17 247.10 247.04 247.36 246.86 246.59  81.49 246.83 246.63 246.63 246.63 246.37 246.48; 247.10 247.34 247.21 247.18 247.04 246.75 246.86 246.69 246.47 246.81  81.45 246.39 246.50 246.50 246.26 246.41; 247.08 247.26 247.18 247.00 247.00 246.88 247.04 246.74 246.57 246.64 246.59  81.33 246.38 246.44 246.26 246.57; 247.11 247.40 247.27 247.22 247.14 247.04 246.99 246.59 246.52 246.83 246.89 246.48  81.40 246.61 246.42 246.51; 247.35 247.23 247.22 247.29 247.01 246.91 246.90 246.57 246.62 246.82 246.72 246.28 246.49  81.35 246.39 246.56; 247.24 247.21 247.25 247.18 247.18 247.13 247.26 246.62 246.64 246.87 246.86 246.54 246.78 246.73  81.36 246.44; 247.13 247.27 247.31 246.84 246.80 246.78 247.04 246.45 246.47 246.79 246.67 246.12 246.43 246.60 246.34  81.34')
bw_pci = ('806.04   8.38   9.53   9.53  10.88  10.86  10.84  10.84  10.65  10.70  10.67  10.65  10.67  10.62  10.69  10.66; 8.37 807.09   9.50   9.47  10.88  10.86  10.86  10.89  10.69  10.66  10.61  10.67  10.59  10.57  10.67  10.62; 9.47   9.46 807.09   9.46  10.86  10.86  10.82  10.83  10.65  10.68  10.57  10.67  10.61  10.58  10.63  10.64; 9.57   9.56   9.48 809.09  10.91  10.92  10.91  10.90  10.65  10.60  10.52  10.65  10.59  10.54  10.62  10.55; 10.89  10.90  10.89  10.87 813.10   8.39   9.50   9.51  10.62  10.65  10.60  10.62  10.63  10.58  10.60  10.62; 10.92  10.91  10.92  10.97   8.39 809.09   9.53   9.53  10.67  10.68  10.60  10.67  10.67  10.61  10.67  10.66; 10.96  10.92  10.95  10.89   9.58   9.59 809.09   9.48  10.61  10.62  10.55  10.56  10.55  10.57  10.58  10.60;  10.94  10.91  10.92  10.87   9.55   9.55   9.46 811.09  10.57  10.63  10.58  10.64  10.56  10.54  10.58  10.56; 10.85  10.81  10.82  10.83  10.80  10.78  10.75  10.79 807.09   8.30   9.06   9.09  10.46  10.45  10.47  10.46;  10.84  10.83  10.81  10.82  10.83  10.81  10.79  10.78   8.29 811.09   9.10   9.11  10.50  10.47  10.49  10.48; 10.81  10.84  10.79  10.79  10.81  10.82  10.79  10.80   9.07   9.07 811.09   9.24  10.46  10.46  10.46  10.43;  10.86  10.87  10.84  10.82  10.83  10.83  10.86  10.87   9.08   9.10   9.22 809.09  10.47  10.48  10.47  10.47; 10.82  10.82  10.79  10.80  10.78  10.81  10.76  10.77  10.46  10.46  10.49  10.45 807.09   8.29   9.07   9.09; 10.85  10.86  10.82  10.85  10.85  10.84  10.84  10.83  10.46  10.46  10.40  10.44   8.30 811.09   9.08   9.07 ;  10.86  10.89  10.84  10.86  10.86  10.88  10.84  10.85  10.42  10.43  10.45  10.49   9.09   9.09 810.65   9.24;  10.89  10.91  10.84  10.86  10.85  10.84  10.83  10.81  10.47  10.46  10.43  10.45   9.10   9.10   9.25 807.53')
bw_nvlink = ('808.09 136.81 136.52 136.69 137.03 137.02 136.84 137.09 137.10 136.59 136.85 135.89 136.36 137.17 137.13 136.30; 136.39 809.09 136.63 136.57 136.60 137.26 136.65 136.88 136.44 136.31 136.40 136.84 136.54 136.21 136.39 136.54; 136.64 136.82 811.09 136.68 136.44 136.80 136.50 136.52 136.88 136.46 136.58 136.43 136.66 136.78 137.07 136.95; 136.45 136.65 136.58 809.09 136.51 136.55 136.55 136.99 136.62 136.60 136.42 136.80 136.69 136.74 136.91 136.67; 136.68 136.59 136.63 136.81 809.09 136.72 136.65 136.57 136.40 136.43 136.52 136.58 136.33 137.07 136.54 136.85; 136.66 136.92 137.10 136.88 137.13 811.09 136.69 136.94 136.54 136.41 136.54 136.84 136.76 136.95 136.93 136.95; 136.90 136.88 136.68 136.86 136.96 136.61 811.09 136.93 136.57 137.15 136.58 136.92 137.07 136.77 136.79 136.62; 136.91 136.95 137.02 136.73 136.85 136.83 136.58 809.09 136.64 136.36 136.88 136.85 136.76 136.78 136.75 136.90; 136.44 136.76 136.12 136.27 136.50 136.60 136.53 136.16 807.09 136.84 136.31 137.24 137.19 136.43 136.54 136.89; 136.54 136.64 136.41 136.48 136.46 136.72 136.33 136.46 136.28 809.09 136.57 136.36 136.76 136.58 136.86 136.61; 136.25 136.52 136.81 136.99 136.42 137.17 136.86 137.15 137.36 136.33 807.09 137.28 137.29 137.27 137.33 137.35; 136.30 136.80 137.17 137.12 137.10 137.07 136.88 137.12 137.04 137.17 136.93 811.09 137.11 137.21 137.42 136.91; 136.21 136.28 137.12 137.02 137.18 137.13 137.15 137.33 137.16 137.31 137.01 137.41 809.09 136.96 136.79 136.33; 136.43 136.55 137.27 137.10 136.36 136.97 136.47 137.17 136.85 137.27 135.91 136.49 137.13 809.09 136.92 136.89; 136.72 136.59 136.65 136.58 136.35 136.40 136.37 136.39 136.69 137.11 137.38 137.52 136.81 136.32 808.28 136.79; 136.36 136.79 137.36 136.30 136.53 136.94 137.16 137.32 137.23 137.29 137.06 137.41 137.09 137.06 137.26 809.77')
bw_bi_pci = ('840.61   8.77  10.27  10.27  16.64  16.65  17.24  17.35  16.63  16.60  17.02  17.03  16.63  16.62  17.03  17.04; 8.77 845.63  10.24  10.26  16.67  16.67  17.13  17.35  16.60  16.58  17.07  17.07  16.60  16.62  17.06  17.10;  10.30  10.27 846.72  10.30  17.34  17.31  18.47  18.47  17.31  17.24  18.03  18.12  17.28  17.29  18.05  18.19;  10.26  10.28  10.30 845.63  17.38  17.34  18.60  18.65  17.27  17.32  18.15  18.18  17.28  17.26  18.14  18.11; 16.64  16.69  17.21  17.18 845.63   8.77  10.26  10.27  16.58  16.61  17.04  17.06  16.63  16.63  17.12  17.10;  16.67  16.71  17.28  17.29   8.77 845.63  10.29  10.30  16.58  16.56  17.09  17.00  16.64  16.61  17.08  17.02;  17.31  17.36  18.51  18.44  10.26  10.28 844.54  10.29  17.26  17.27  17.99  18.07  17.25  17.27  18.17  18.06;  17.17  17.34  18.64  18.65  10.29  10.28  10.28 845.63  17.32  17.23  17.97  18.22  17.33  17.29  18.10  18.21; 16.64  16.61  17.09  17.11  16.61  16.64  17.08  17.07 845.63   8.75  10.24  10.25  16.54  16.54  16.91  16.86;  16.58  16.64  17.09  17.03  16.61  16.62  17.03  17.01   8.75 844.54  10.25  10.27  16.57  16.53  16.90  16.93;  17.31  17.30  18.12  18.16  17.35  17.34  17.98  18.17  10.24  10.24 845.63  10.27  16.96  16.93  17.28  17.33;  17.31  17.27  18.09  18.26  17.28  17.35  18.13  18.25  10.24  10.24  10.22 845.63  16.93  16.94  17.25  17.26;  16.60  16.61  17.03  16.98  16.63  16.63  17.06  17.04  16.55  16.53  16.95  16.87 844.54   8.75  10.25  10.26;  16.58  16.62  17.07  17.06  16.64  16.62  17.05  17.06  16.56  16.54  16.96  16.96   8.76 844.54  10.27  10.29;  17.32  17.32  18.15  18.24  17.33  17.31  18.22  18.09  16.90  16.91  17.20  17.22  10.26  10.22 844.40  10.27;  17.33  17.27  18.13  18.23  17.31  17.39  18.23  18.13  16.92  16.94  17.28  17.30  10.25  10.25  10.27 844.60 ')
bw_bi_nvlink = ('841.25 252.43 255.44 254.21 255.20 258.75 254.34 257.48 254.64 253.78 255.91 254.90 254.92 253.46 256.62 258.91; 254.02 842.37 254.81 257.41 254.61 258.42 255.20 256.00 253.43 251.87 257.61 252.84 255.00 255.00 256.60 256.80; 252.64 255.20 844.54 256.40 256.00 258.42 254.61 258.63 253.43 255.40 257.61 254.81 256.00 254.41 258.42 258.22; 255.00 254.21 257.41 843.45 255.80 257.81 256.00 258.63 254.61 254.21 256.40 254.02 253.43 254.81 259.45 259.86; 256.20 253.62 256.80 256.80 842.37 258.42 254.61 257.21 254.81 255.40 258.22 254.61 253.62 255.40 258.22 257.21; 253.82 254.21 256.60 257.41 257.41 842.37 255.80 256.40 253.43 253.82 259.86 256.20 256.80 255.20 259.45 259.45; 255.20 253.43 256.80 256.40 256.20 256.20 843.45 255.40 255.60 256.20 257.81 256.00 254.41 255.00 256.20 258.22; 252.06 252.64 257.21 257.61 256.20 258.22 253.23 842.37 255.40 255.40 256.20 256.00 256.40 254.21 256.60 259.45; 254.02 252.26 255.80 256.00 253.82 256.60 254.21 257.41 843.45 253.62 256.40 255.00 251.87 251.48 253.43 255.40; 254.02 252.45 253.82 256.40 255.80 256.40 253.82 256.00 253.03 842.37 255.80 254.41 253.03 253.03 255.40 256.60; 254.81 254.02 257.00 257.41 255.80 258.63 254.21 257.81 255.60 255.60 844.54 256.40 255.20 254.02 259.45 258.22; 253.62 254.81 255.20 256.60 257.81 258.02 253.23 256.40 253.03 255.80 257.21 843.45 252.26 254.02 257.81 256.80; 253.82 252.06 256.20 255.80 254.02 258.02 252.84 256.40 255.00 254.81 256.40 254.81 843.45 252.84 252.26 255.40; 255.40 255.00 257.00 256.20 255.00 257.61 254.81 255.60 255.00 254.61 258.02 254.81 251.48 843.45 258.63 257.41; 253.38 254.33 259.05 258.16 255.76 256.89 253.54 254.42 253.33 256.08 259.79 255.40 253.70 256.02 842.67 259.37; 253.87 253.71 256.02 256.46 257.19 256.97 254.42 256.74 255.54 256.23 256.09 255.87 255.84 255.06 259.05 842.26')

custom_color_map_dual = LinearSegmentedColormap.from_list(
    name='custom_cmap', 
    colors =['aliceblue', 'midnightblue'],
    N=50
)
custom_color_map_tripple = LinearSegmentedColormap.from_list(
    name='custom_cmap', 
    colors =['#4C7E80', 'lightcyan', '#e6f2fc', 'midnightblue'],
    N=70
)
custom_color_map_fripple = LinearSegmentedColormap.from_list(
    name='custom_cmap', 
    colors =['darkslategrey', 'powderblue', 'aliceblue', 'midnightblue'],
    N=70
)
custom_color_map_tripple_bw = LinearSegmentedColormap.from_list(
    name='custom_cmap', 
    colors =['#a63d54', '#f0e0ff', '#215e8f'],
    N=70
)
# colors =['PaleTurquoise', 'midnightblue'],
#     colors =['cadetblue', 'aliceblue', 'midnightblue'],

# Other cmaps: 'RdGy_r', 'PuBuGn', 'pink_r'
# plt.imshow(nm, cmap='PuBuGn', vmin=5, vmax=15, interpolation='nearest')

#create_heat_map(a2, custom_color_map_dual, "ms-latency-nvlink.svg")
#create_heat_map(a, custom_color_map_dual, "ms-latency-pcie.svg")
#create_heat_map(a5, custom_color_map_dual, "yme-latency-nvlink.svg")
#create_heat_map(a4, custom_color_map_dual, "yme-latency-pcie.svg")
#create_heat_map(a3, custom_color_map_tripple, "dgx2-latency-pcie.svg")
#create_heat_map(a6, custom_color_map_tripple, "dgx2-latency-nvlink.svg")
#create_heat_map(bw_pci, custom_color_map_tripple_bw, "dgx2-bw-uni-pcie.svg")
#create_heat_map(bw_nvlink, custom_color_map_tripple_bw, "dgx2-bw-uni-nvlink.svg")
#create_heat_map(bw_bi_pci, custom_color_map_tripple_bw, "dgx2-bw-bi-pcie.svg")
#create_heat_map(bw_bi_nvlink, custom_color_map_tripple_bw, "dgx2-bw-bi-nvlink.svg")

#create_heat_map(yme_bw_uni_pci, custom_color_map_tripple_bw, "yme-bw-uni-pci.svg")
#create_heat_map(yme_bw_uni_nvlink, custom_color_map_tripple_bw, "yme-bw-uni-nvlink.svg")
#create_heat_map(yme_bw_bi_pci, custom_color_map_tripple_bw, "yme-bw-bi-pci.svg")
#create_heat_map(yme_bw_bi_nvlink, custom_color_map_tripple_bw, "yme-bw-bi-nvlink.svg")


create_heat_map(ms_bw_uni_pci, custom_color_map_tripple_bw, "ms-bw-uni-pci.svg")
create_heat_map(ms_bw_uni_nvlink, custom_color_map_tripple_bw, "ms-bw-uni-nvlink.svg")
create_heat_map(ms_bw_bi_pci, custom_color_map_tripple_bw, "ms-bw-bi-pci.svg")
create_heat_map(ms_bw_bi_nvlink, custom_color_map_tripple_bw, "ms-bw-bi-nvlink.svg")